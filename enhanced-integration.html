<!DOCTYPE html>
<html>
<head>
    <title>Enhanced coreFORCE Integration with CSS Isolation</title>
    <style>
        /* Inline CSS Isolation - Apply this directly in coreFORCE */
        #react-checkout-root {
            /* Complete isolation */
            all: initial !important;
            display: block !important;
            box-sizing: border-box !important;
            
            /* Establish new formatting context */
            contain: layout style !important;
            isolation: isolate !important;
            
            /* Reset to known good values */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
            font-size: 16px !important;
            line-height: 1.5 !important;
            color: #111827 !important;
            background: #f9fafb !important;
            
            /* Ensure full width and proper positioning */
            width: 100% !important;
            min-height: 500px !important;
            margin: 0 !important;
            padding: 20px !important;
            
            /* Prevent parent interference */
            position: relative !important;
            z-index: 9999 !important;
            overflow: visible !important;
            
            /* Reset any inherited transforms or flex properties */
            transform: none !important;
            flex: none !important;
            grid-area: auto !important;
        }
        
        /* Aggressive reset for all children */
        #react-checkout-root *,
        #react-checkout-root *::before,
        #react-checkout-root *::after {
            box-sizing: border-box !important;
        }
        
        /* Reset specific elements that commonly inherit problematic styles */
        #react-checkout-root div,
        #react-checkout-root span,
        #react-checkout-root p,
        #react-checkout-root h1,
        #react-checkout-root h2,
        #react-checkout-root h3,
        #react-checkout-root h4,
        #react-checkout-root h5,
        #react-checkout-root h6,
        #react-checkout-root button,
        #react-checkout-root input,
        #react-checkout-root select,
        #react-checkout-root textarea,
        #react-checkout-root form,
        #react-checkout-root label,
        #react-checkout-root table,
        #react-checkout-root tr,
        #react-checkout-root td,
        #react-checkout-root th {
            margin: initial !important;
            padding: initial !important;
            border: initial !important;
            background: initial !important;
            font-family: inherit !important;
            font-size: inherit !important;
            line-height: inherit !important;
            color: inherit !important;
            text-decoration: initial !important;
            text-transform: initial !important;
            letter-spacing: initial !important;
            word-spacing: initial !important;
            vertical-align: initial !important;
            text-align: initial !important;
        }
        
        /* Force proper display for layout elements */
        #react-checkout-root .grid {
            display: grid !important;
        }
        
        #react-checkout-root .flex {
            display: flex !important;
        }
        
        /* Ensure buttons work properly */
        #react-checkout-root button {
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            border: none !important;
            background: transparent !important;
        }
        
        /* Form element resets */
        #react-checkout-root input,
        #react-checkout-root select,
        #react-checkout-root textarea {
            display: block !important;
            width: auto !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
        }
        
        /* Image handling */
        #react-checkout-root img {
            max-width: 100% !important;
            height: auto !important;
            display: block !important;
        }
        
        /* Modal and overlay protection */
        #react-checkout-root .fixed {
            position: fixed !important;
            z-index: 99999 !important;
        }
        
        /* Container protection */
        #react-checkout-root .min-h-screen {
            min-height: 100vh !important;
        }
        
        #react-checkout-root .max-w-6xl,
        #react-checkout-root .max-w-7xl {
            max-width: 1200px !important;
            margin-left: auto !important;
            margin-right: auto !important;
        }
    </style>
</head>
<body>

<!-- Your coreFORCE page content -->
<div class="some-coreforce-content">
    <!-- This is where you put the checkout -->
    <div id="react-checkout-root"></div>
</div>

<script>
// Enhanced coreFORCE Integration with Inline CSS Isolation
var originalJQuery = window.jQuery;
var original$ = window.$;

function loadCheckoutApp() {
    // Load CSS - use working URL for now
    var link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = 'https://lerrysuzara.github.io/checkout2025/assets/index-22ac9191.css';
    document.head.appendChild(link);
    
    // Load JS - use working URL for now  
    var script = document.createElement('script');
    script.type = 'module';
    script.src = 'https://lerrysuzara.github.io/checkout2025/assets/index-a4ea1767.js';
    script.onload = function() {
        console.log('‚úÖ React app script loaded');
        setTimeout(function() {
            if (window.updateCartData) {
                console.log('‚úÖ React app ready, loading cart data...');
                xloadCartFromCoreFORCEx();
            } else {
                console.log('‚ö†Ô∏è React app not ready yet, will retry...');
                setTimeout(function() {
                    xloadCartFromCoreFORCEx();
                }, 2000);
            }
        }, 1500);
    };
    document.head.appendChild(script);
}

var cartItems = null;

function getShoppingCartItemsXX() {
    loadAjaxRequest("/retail-store-controller?ajax=true&url_action=get_shopping_cart_items", function (returnArray) {
        cartItems = returnArray;
        console.log('‚úÖ Cart items loaded:', cartItems);
        checkAndLoadCartData();
    });
}

function checkAndLoadCartData() {
    if (cartItems && window.updateCartData) {
        window.updateCartData(cartItems);
        console.log('‚úÖ Cart data loaded successfully');
        return true;
    } else if (!cartItems) {
        console.log('üîÑ Cart data not ready, loading...');
        getShoppingCartItemsXX();
        return false;
    } else if (!window.updateCartData) {
        console.log('üîÑ React app not ready yet');
        return false;
    }
    return false;
}

function xloadCartFromCoreFORCEx() {
    try {
        console.log('üîÑ loadCartFromCoreFORCE called');
        
        if (!checkAndLoadCartData()) {
            var retryCount = 0;
            var maxRetries = 5;
            
            var retryInterval = setInterval(function() {
                retryCount++;
                console.log('üîÑ Retry attempt ' + retryCount + ' of ' + maxRetries);
                
                if (checkAndLoadCartData()) {
                    clearInterval(retryInterval);
                    console.log('‚úÖ Cart data loaded successfully on retry');
                } else if (retryCount >= maxRetries) {
                    clearInterval(retryInterval);
                    console.log('‚ùå Failed to load cart data after ' + maxRetries + ' attempts');
                }
            }, 2000);
        }
    } catch (error) {
        console.error('‚ùå Error loading cart from coreFORCE:', error);
    }
}

function restoreJQuery() {
    if (originalJQuery && (!window.jQuery || typeof window.jQuery.ajaxSetup !== 'function')) {
        window.jQuery = originalJQuery;
    }
    if (original$ && (!window.$ || typeof window.$.ajaxSetup !== 'function')) {
        window.$ = original$;
    }
}

// Initialize
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        loadCheckoutApp();
    });
} else {
    loadCheckoutApp();
}

setInterval(restoreJQuery, 1000);

console.log('üöÄ Enhanced coreFORCE checkout integration loaded');
</script>

</body>
</html>