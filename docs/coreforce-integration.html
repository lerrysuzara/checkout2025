<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coreFORCE GitHub Pages Integration</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
        }
        .control-panel {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.loading { background: #fff3cd; color: #856404; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        
        /* React app container styles */
        #react-checkout-root {
            min-height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ coreFORCE GitHub Pages Integration</h1>
            <p>This demonstrates integration with the React checkout app hosted on GitHub Pages</p>
        </div>

        <div class="control-panel">
            <h3>üîß Control Panel</h3>
            <p>Click the button below to load cart data from coreFORCE:</p>
            
            <button class="btn btn-success" onclick="loadCartData()">
                üõí Load Cart Data from coreFORCE
            </button>
            
            <button class="btn" onclick="loadMockData()">
                üìã Load Mock Data
            </button>
            
            <button class="btn" onclick="checkReactAppStatus()">
                üîç Check React App Status
            </button>
            
            <div id="status" class="status">Ready to load cart data</div>
        </div>

        <!-- React Checkout App Container -->
        <div id="react-checkout-root"></div>
    </div>

    <script>
        // Store original jQuery references
        var originalJQuery = window.jQuery;
        var original$ = window.$;
        
        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
        }
        
        // coreFORCE getShoppingCartItems function
        window.getShoppingCartItems = function() {
            console.log('üîÑ coreFORCE getShoppingCartItems() called');
            
            // Return your actual coreFORCE cart data here
            return {
                "order_upsell_products": {
                    "1100654": {
                        "product_id": 1100654,
                        "description": "Discrete Packaging",
                        "quantity": 1,
                        "sale_price": "3.00",
                        "total_cost": "3.00",
                        "required": false,
                        "checked": ""
                    },
                    "1100655": {
                        "product_id": 1100655,
                        "description": "Insurance",
                        "quantity": 1,
                        "sale_price": "15.96",
                        "total_cost": "15.96",
                        "required": false,
                        "checked": ""
                    }
                },
                "estimated_shipping_charge": "25.00",
                "default_location_id": 71,
                "location_description": "TEST",
                "jquery_templates": "",
                "custom_field_data": [],
                "total_savings": "128.01",
                "retail_agreements": [],
                "shipping_required": true,
                "pickup_locations": false,
                "valid_payment_methods": "22,81,82,83,85,110,111,118,119,151,172,173",
                "shopping_cart_items": [
                    {
                        "shopping_cart_item_id": 199835,
                        "shopping_cart_id": 4841739,
                        "product_id": 1174658,
                        "description": "Walther Arms PD22L1   22LR 200 Per Box/10 Case",
                        "location_id": "",
                        "serial_number": "",
                        "time_submitted": "2025-07-24 22:45:41",
                        "quantity": 1,
                        "sale_price": "26.79",
                        "promotion_id": "",
                        "version": 1,
                        "product_addons": [],
                        "addon_count": 0,
                        "promotion_requirements": 0,
                        "order_upsell_product": false,
                        "price_calculation": "Using pricing structure: Default Price\nProduct ID: 1174559 - BANISH 30 30CAL FDE\nNo Client Sale Price Found\nReference Price: 700.00\nStarting Percentage used: 10\nBase Cost: 700\nPercent Markup: 10\nSale Price: 770\nSale Price after rounding rules: 770.99\nUsing pricing structure: Default Price\nProduct ID: 1174658 - Walther Arms PD22L1   22LR 200 Per Box/10 Case\nNo Client Sale Price Found\nReference Price: 24.00\nStarting Percentage used: 10\nBase Cost: 24\nPercent Markup: 10\nSale Price: 26.4\nSale Price after rounding rules: 26.79\n",
                        "product_tag_ids": "",
                        "unit_price": "26.79",
                        "map_policy": "STRICT",
                        "product_code": "S1_184000",
                        "upc_code": "723364234477",
                        "manufacturer_sku": "PD22L1",
                        "model": "",
                        "list_price": "",
                        "small_image_url": "/cache/image-small-950710-54fe317fd53ae2d16772bc0842bef10d.webp",
                        "image_url": "/cache/image-full-950710-54fe317fd53ae2d16772bc0842bef10d.webp",
                        "base_cost": "24.00",
                        "original_sale_price": "",
                        "discount": "",
                        "savings": "",
                        "inventory_quantity": 2000,
                        "product_restrictions": "",
                        "shipping_options": {
                            "pickup": false,
                            "ship_to_store": true,
                            "ship_to_home": true,
                            "ship_to_ffl": false
                        },
                        "pickup": "",
                        "ship_to_store": "shipping-option-ship-to-store",
                        "ship_to_home": "shipping-option-ship-to-home",
                        "ship_to_ffl": "",
                        "cart_maximum": "",
                        "cart_minimum": "",
                        "no_online_order": 0,
                        "custom_fields": "",
                        "custom_field_classes": "",
                        "item_addons": "",
                        "addon_classes": "",
                        "other_classes": ""
                    },
                    {
                        "shopping_cart_item_id": 199836,
                        "shopping_cart_id": 4841739,
                        "product_id": 1174559,
                        "description": "BANISH 30 30CAL FDE",
                        "location_id": "",
                        "serial_number": "",
                        "time_submitted": "2025-07-24 22:46:13",
                        "quantity": 1,
                        "sale_price": "770.99",
                        "promotion_id": "",
                        "version": 1,
                        "product_addons": [],
                        "addon_count": 0,
                        "promotion_requirements": 0,
                        "order_upsell_product": false,
                        "price_calculation": "Using pricing structure: Default Price\nProduct ID: 1174559 - BANISH 30 30CAL FDE\nNo Client Sale Price Found\nReference Price: 700.00\nStarting Percentage used: 10\nBase Cost: 700\nPercent Markup: 10\nSale Price: 770\nSale Price after rounding rules: 770.99\n",
                        "product_tag_ids": "13,14",
                        "unit_price": "770.99",
                        "map_policy": "",
                        "product_code": "L4_BX100000110949",
                        "upc_code": "810171221643",
                        "manufacturer_sku": "100000110949",
                        "model": "Banish 30",
                        "list_price": "899.00",
                        "small_image_url": "/cache/image-small-950528-0ef5da8aa2cd0f3c5963e5acfbbb1dc0.webp",
                        "image_url": "/cache/image-full-950528-0ef5da8aa2cd0f3c5963e5acfbbb1dc0.webp",
                        "base_cost": "700.00",
                        "original_sale_price": "899.00",
                        "discount": "14%",
                        "savings": "128.01",
                        "inventory_quantity": 63,
                        "product_restrictions": "",
                        "shipping_options": {
                            "pickup": false,
                            "ship_to_store": true,
                            "ship_to_home": false,
                            "ship_to_ffl": true
                        },
                        "pickup": "",
                        "ship_to_store": "shipping-option-ship-to-store",
                        "ship_to_home": "",
                        "ship_to_ffl": "shipping-option-ship-to-ffl",
                        "cart_maximum": "",
                        "cart_minimum": "",
                        "no_online_order": 0,
                        "custom_fields": "",
                        "custom_field_classes": "",
                        "item_addons": "",
                        "addon_classes": "",
                        "other_classes": "product-tag-ffl_required product-tag-class_3"
                    }
                ],
                "promotion_id": "",
                "promotion_code": "",
                "promotion_code_description": "",
                "promotion_code_details": "",
                "discount_amount": 0,
                "discount_percent": 0,
                "shopping_cart_item_count": 2,
                "loyalty_points_awarded": "This purchase will add 120 loyalty points to your account. Add $202.22 in product to this order to jump to the next level.",
                "analytics_event": {
                    "event": "load_cart",
                    "event_data": {
                        "items": []
                    }
                }
            };
        };

        // Function to explicitly load cart data
        function loadCartData() {
            updateStatus('Loading cart data from coreFORCE...', 'loading');
            
            try {
                // Get cart data from coreFORCE
                const cartData = window.getShoppingCartItems();
                
                if (cartData) {
                    // Use global function to update React app
                    if (typeof window.updateCartData === 'function') {
                        window.updateCartData(cartData);
                        updateStatus('Cart data loaded successfully!', 'success');
                        console.log('‚úÖ Cart data loaded and sent to React app');
                    } else {
                        updateStatus('React app not ready yet - updateCartData not available', 'error');
                        console.log('‚ùå updateCartData not available, React app may not be loaded');
                    }
                } else {
                    updateStatus('Failed to load cart data', 'error');
                }
            } catch (error) {
                console.error('Error loading cart data:', error);
                updateStatus('Error loading cart data: ' + error.message, 'error');
            }
        }

        // Function to load mock data
        function loadMockData() {
            updateStatus('Loading mock data...', 'loading');
            
            // Simulate loading mock data
            setTimeout(() => {
                const mockData = {
                    items: [
                        {
                            id: "1",
                            name: "Mock Product 1",
                            price: 99.99,
                            quantity: 1,
                            image: "https://via.placeholder.com/64x64?text=Product1",
                            description: "This is a mock product for testing"
                        }
                    ],
                    summary: {
                        subtotal: 99.99,
                        shipping: 9.99,
                        tax: 8.80,
                        total: 118.78,
                        currency: 'USD',
                        discount: 0,
                        discountPercent: 0,
                        promotionCode: '',
                        promotionDescription: '',
                        loyaltyPoints: '',
                        totalSavings: 0
                    },
                    rawData: null
                };
                
                console.log('üì¶ Dispatching mock data:', mockData);
                
                // Use global function to update React app
                if (typeof window.updateCartData === 'function') {
                    window.updateCartData(mockData);
                    updateStatus('Mock data loaded successfully!', 'success');
                    console.log('‚úÖ Mock data sent to React app');
                } else {
                    updateStatus('React app not ready yet - updateCartData not available', 'error');
                    console.log('‚ùå updateCartData not available, React app may not be loaded');
                }
            }, 1000);
        }

        // Load React app directly (no iframe)
        function loadReactApp() {
            try {
                updateStatus('Loading React app...', 'loading');
                
                // Load CSS first
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = './assets/index-b7712f17.css';
                link.onload = function() {
                    console.log('‚úÖ CSS loaded');
                    
                    // Load the main React app script
                    var script = document.createElement('script');
                    script.type = 'module';
                    script.src = './assets/index-c478256f.js';
                    script.onload = function() {
                        console.log('‚úÖ React app script loaded');
                        updateStatus('React app loaded successfully', 'success');
                        
                        // Wait for React to initialize
                        setTimeout(() => {
                            if (typeof window.updateCartData === 'function') {
                                console.log('‚úÖ updateCartData function is available');
                                updateStatus('React app fully ready - click button to load cart data', 'success');
                            } else {
                                console.log('‚ö†Ô∏è updateCartData function not yet available, waiting...');
                                // Check again after a delay
                                setTimeout(() => {
                                    if (typeof window.updateCartData === 'function') {
                                        console.log('‚úÖ updateCartData function is now available');
                                        updateStatus('React app fully ready - click button to load cart data', 'success');
                                    } else {
                                        console.log('‚ùå updateCartData function still not available');
                                        updateStatus('React app loaded but updateCartData not available', 'error');
                                    }
                                }, 2000);
                            }
                        }, 1000);
                    };
                    script.onerror = function() {
                        console.error('‚ùå Failed to load React app script');
                        updateStatus('Failed to load React app script', 'error');
                    };
                    document.head.appendChild(script);
                };
                link.onerror = function() {
                    console.error('‚ùå Failed to load CSS');
                    updateStatus('Failed to load CSS', 'error');
                };
                document.head.appendChild(link);
                
            } catch (error) {
                console.error('Error loading React app:', error);
                updateStatus('Error loading React app: ' + error.message, 'error');
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadReactApp);
        } else {
            loadReactApp();
        }

        // Restore jQuery if needed
        function restoreJQuery() {
            if (originalJQuery && (!window.jQuery || typeof window.jQuery.ajaxSetup !== 'function')) {
                window.jQuery = originalJQuery;
            }
            if (original$ && (!window.$ || typeof window.$.ajaxSetup !== 'function')) {
                window.$ = original$;
            }
        }

        // Monitor for jQuery conflicts
        setInterval(restoreJQuery, 1000);
        
        // Function to check React app status
        function checkReactAppStatus() {
            console.log('üîç Checking React app status...');
            console.log('window.updateCartData:', typeof window.updateCartData);
            console.log('window.isReactAppReady:', typeof window.isReactAppReady);
            
            if (typeof window.updateCartData === 'function') {
                updateStatus('‚úÖ React app is ready - updateCartData function available', 'success');
            } else if (typeof window.isReactAppReady === 'function' && window.isReactAppReady()) {
                updateStatus('‚úÖ React app is ready - isReactAppReady returned true', 'success');
            } else {
                updateStatus('‚ùå React app not ready - updateCartData function not available', 'error');
            }
        }
        
        console.log('üöÄ GitHub Pages integration initialized');
    </script>
</body>
</html> 