<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coreFORCE Integration - jQuery Safe</title>
    
    <style>
        /* Isolated styles */
        .react-checkout-wrapper {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            isolation: isolate;
        }
        .react-checkout-wrapper * {
            box-sizing: border-box;
        }
        .status-indicator {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
        .status-loading { background: #fff3cd; color: #856404; }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="react-checkout-wrapper">
        <h3>🔗 jQuery-Safe React Checkout Integration</h3>
        <div id="status" class="status-indicator status-loading">Initializing...</div>
        
        <!-- React Checkout App Container -->
        <div id="react-checkout-root"></div>
    </div>

    <script>
        // jQuery-safe integration
        (function() {
            'use strict';
            
            var statusEl = document.getElementById('status');
            
            function updateStatus(message, type) {
                statusEl.textContent = message;
                statusEl.className = 'status-indicator status-' + type;
                console.log('Status:', message);
            }
            
            // Store original jQuery and $ references
            var originalJQuery = window.jQuery;
            var original$ = window.$;
            var jqueryRestored = false;
            
            updateStatus('Preserving jQuery references...', 'loading');
            
            // This function should be provided by coreFORCE
            window.getShoppingCartItems = function() {
                console.log('🔄 coreFORCE getShoppingCartItems() called');
                
                // Return your actual coreFORCE cart data here
                return {
                    "order_upsell_products": {
                        "91349152": {
                            "product_id": 91349152,
                            "description": "Discrete Packaging",
                            "quantity": 3,
                            "sale_price": "3.00",
                            "total_cost": "9.00",
                            "required": false,
                            "checked": ""
                        }
                    },
                    "estimated_shipping_charge": "41.95",
                    "default_location_id": "",
                    "jquery_templates": "",
                    "custom_field_data": [],
                    "total_savings": "79.05",
                    "retail_agreements": [],
                    "shipping_required": true,
                    "pickup_locations": false,
                    "valid_payment_methods": "297,361,595,710,711,712,713,722,723,724",
                    "shopping_cart_items": [
                        {
                            "shopping_cart_item_id": 1839696,
                            "shopping_cart_id": 79655841,
                            "product_id": 91957734,
                            "description": "USED GLOCK 43 PISTOL 9MM 2-6RD MAGS EXCELLENT COND.",
                            "location_id": "",
                            "serial_number": "",
                            "time_submitted": "2025-07-25 01:06:08",
                            "quantity": 1,
                            "sale_price": "395.95",
                            "promotion_id": "",
                            "version": 1,
                            "product_addons": [],
                            "addon_count": 0,
                            "promotion_requirements": 0,
                            "order_upsell_product": false,
                            "price_calculation": "Using pricing structure: Firearms...",
                            "product_tag_ids": "715",
                            "original_sale_price": "475.00",
                            "unit_price": "395.95",
                            "map_policy": "STRICT",
                            "product_code": "Z4_GHG4938X",
                            "upc_code": "787450540255",
                            "manufacturer_sku": "",
                            "model": "",
                            "list_price": "475.00",
                            "small_image_url": "https://range-test.coreware.com/cache/image-small-386986-0755e42dbde8b329cc777d0f5c9c0406.webp",
                            "image_url": "https://range-test.coreware.com/cache/image-full-386986-0755e42dbde8b329cc777d0f5c9c0406.webp",
                            "base_cost": "359.95",
                            "discount": "17%",
                            "savings": "79.05",
                            "inventory_quantity": 21,
                            "product_restrictions": "",
                            "shipping_options": {
                                "pickup": false,
                                "ship_to_store": false,
                                "ship_to_home": true,
                                "ship_to_ffl": false
                            },
                            "pickup": "",
                            "ship_to_store": "",
                            "ship_to_home": "shipping-option-ship-to-home",
                            "ship_to_ffl": "",
                            "cart_maximum": "",
                            "cart_minimum": "",
                            "no_online_order": 0,
                            "custom_fields": "",
                            "custom_field_classes": "",
                            "item_addons": "",
                            "addon_classes": "",
                            "other_classes": "product-tag-new_product"
                        },
                        {
                            "shopping_cart_item_id": 1839697,
                            "shopping_cart_id": 79655841,
                            "product_id": 91957598,
                            "description": "RUGER RXM 9MM PISTOL 4\" AMERICAN FLAG O.R. 2-15RD MAGS - ORION EXCLUSIVE",
                            "location_id": "",
                            "serial_number": "",
                            "time_submitted": "2025-07-25 01:10:24",
                            "quantity": 1,
                            "sale_price": "469.28",
                            "promotion_id": "",
                            "version": 1,
                            "product_addons": [],
                            "addon_count": 0,
                            "promotion_requirements": 0,
                            "order_upsell_product": false,
                            "price_calculation": "Using pricing structure: Firearms...",
                            "product_tag_ids": "457,715",
                            "original_sale_price": "",
                            "unit_price": "469.28",
                            "map_policy": "CART_PRICE",
                            "product_code": "O17_RUGE19400-FLAG",
                            "upc_code": "756542285992",
                            "manufacturer_sku": "19400-FLAG",
                            "model": "RXM",
                            "list_price": "419.00",
                            "small_image_url": "https://range-test.coreware.com/cache/image-small-386556-5d268d52e3177a9f99c4a4afc7b0a755.webp",
                            "image_url": "https://range-test.coreware.com/cache/image-full-386556-5d268d52e3177a9f99c4a4afc7b0a755.webp",
                            "base_cost": "419.00",
                            "discount": "",
                            "savings": "",
                            "inventory_quantity": 54,
                            "product_restrictions": "",
                            "shipping_options": {
                                "pickup": false,
                                "ship_to_store": false,
                                "ship_to_home": false,
                                "ship_to_ffl": true
                            },
                            "pickup": "",
                            "ship_to_store": "",
                            "ship_to_home": "",
                            "ship_to_ffl": "shipping-option-ship-to-ffl",
                            "cart_maximum": "",
                            "cart_minimum": "",
                            "no_online_order": 0,
                            "custom_fields": "",
                            "custom_field_classes": "",
                            "item_addons": "",
                            "addon_classes": "",
                            "other_classes": "product-tag-ffl_required product-tag-new_product"
                        }
                    ],
                    "promotion_code": "OVER100",
                    "promotion_id": 1,
                    "promotion_code_description": "Over 100 Discount",
                    "promotion_code_details": "",
                    "discount_amount": "0.00",
                    "discount_percent": "20.00",
                    "shopping_cart_item_count": 2,
                    "loyalty_points_awarded": "This purchase will add 10 loyalty points to your account.",
                    "analytics_event": {
                        "event": "load_cart",
                        "event_data": {
                            "items": []
                        }
                    }
                };
            };

            // Function to restore jQuery if needed
            function restoreJQuery() {
                if (!jqueryRestored) {
                    if (originalJQuery && (!window.jQuery || typeof window.jQuery.ajaxSetup !== 'function')) {
                        window.jQuery = originalJQuery;
                        console.log('✅ Restored original jQuery');
                    }
                    if (original$ && (!window.$ || typeof window.$.ajaxSetup !== 'function')) {
                        window.$ = original$;
                        console.log('✅ Restored original $');
                    }
                    jqueryRestored = true;
                }
            }

            // Monitor for jQuery conflicts and restore when needed
            function monitorJQuery() {
                setInterval(function() {
                    if (window.jQuery && typeof window.jQuery.ajaxSetup !== 'function') {
                        console.warn('⚠️ jQuery conflict detected, restoring...');
                        restoreJQuery();
                    }
                    if (window.$ && typeof window.$.ajaxSetup !== 'function') {
                        console.warn('⚠️ $ conflict detected, restoring...');
                        restoreJQuery();
                    }
                }, 1000);
            }

            // Load React app with jQuery protection
            function loadReactApp() {
                updateStatus('Loading React checkout app...', 'loading');
                
                try {
                    // Load CSS first
                    var link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = 'https://lerrysuzara.github.io/checkout2025/assets/index-449700de.css';
                    link.onload = function() {
                        console.log('✅ CSS loaded');
                        
                        // Load JS after CSS
                        var script = document.createElement('script');
                        script.src = 'https://lerrysuzara.github.io/checkout2025/assets/index-3b19ec32.js';
                        script.onload = function() {
                            console.log('✅ React app loaded successfully');
                            updateStatus('React checkout app loaded successfully!', 'success');
                            
                            // Start monitoring for jQuery conflicts
                            monitorJQuery();
                        };
                        script.onerror = function() {
                            console.error('❌ Failed to load React app');
                            updateStatus('Failed to load React app', 'error');
                        };
                        document.head.appendChild(script);
                    };
                    link.onerror = function() {
                        console.error('❌ Failed to load CSS');
                        updateStatus('Failed to load CSS', 'error');
                    };
                    document.head.appendChild(link);
                    
                } catch (error) {
                    console.error('Error loading React app:', error);
                    updateStatus('Error loading React app: ' + error.message, 'error');
                }
            }

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    updateStatus('DOM ready, starting integration...', 'loading');
                    loadReactApp();
                });
            } else {
                updateStatus('DOM ready, starting integration...', 'loading');
                loadReactApp();
            }

            // Also restore jQuery on window load
            window.addEventListener('load', function() {
                setTimeout(restoreJQuery, 100);
            });

            // Export restore function for manual use
            window.restoreCoreFORCEjQuery = restoreJQuery;
            
            console.log('🚀 jQuery-safe coreFORCE integration initialized');
        })();
    </script>
</body>
</html> 